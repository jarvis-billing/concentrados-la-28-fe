<div class="container mb-5">
    <h3 class="text-center mt-4 mb-5 text-primary">Producto</h3>
    <form class="row gx-3" #formulario="ngForm">
        
        <div class="text-left mt-4 mb-5">
            <button class="btn btn-primary" type="reset" (click)="volverProducto()">Regresar</button>
        </div>

        <div class="col-md-12">
            <div class="form-floating">
                <input type="text" class="form-control" id="barcode" name="barcode" placeholder="name@example.com" [(ngModel)]="producto.barcode" #barcode="ngModel" required maxlength="100" (change)="buscarProductoPorCodigoBarras()">
                <label for="barcode">Código de Barras</label>
                @if (barcode.invalid && (barcode.touched || formulario.submitted)) {
                    @if (barcode?.errors?.['required']) {
                        <div class="alert alert-dismissible alert-danger mt-2">
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            <strong>Error:</strong> El campo es requerido.
                        </div>
                    }
                }
            </div>
        </div>

        <div class="col-md-12 mb-4">
            <label for="descripcion" class="form-label mt-4">Descripción</label>
            <textarea class="form-control" id="descripcion" name="descripcion" rows="3" [(ngModel)]="producto.description"></textarea>
        </div>

        <div class="col-md-6 mb-4">
            <div class="form-floating">
                <input type="number" class="form-control" id="precio" name="precio" [(ngModel)]="producto.price" #precio="ngModel" required [min]="minPrecio" [max]="maxPrecio">
                <label for="precio">Precio Venta</label>
                @if (precio.invalid && (precio.touched || formulario.submitted)) {
                    @if (precio?.errors?.['required']) {
                        <div class="alert alert-dismissible alert-danger mt-2">
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            <strong>Error:</strong> El campo es requerido.
                        </div>
                    }
                    @if (precio?.errors?.['min']) {
                        <div class="alert alert-dismissible alert-danger mt-2">
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            <strong>Error:</strong> Debe ingresar un valor superior a {{minPrecio}}.
                        </div>
                    }
                    @if (precio?.errors?.['max']) {
                        <div class="alert alert-dismissible alert-danger mt-2">
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            <strong>Error:</strong> Debe ingresar un valor inferior a {{maxPrecio}}.
                        </div>
                    }
                }
            </div>
        </div>

        <div class="col-md-6 mb-4">
            <div class="form-floating">
                <input type="number" class="form-control" id="costo" name="costo" placeholder="0" [(ngModel)]="producto.cost" #costo="ngModel" required [min]="minPrecio" [max]="maxPrecio">
                <label for="precio">Costo Compra</label>
                @if (costo.invalid && (costo.touched || formulario.submitted)) {
                    @if (costo?.errors?.['required']) {
                        <div class="alert alert-dismissible alert-danger mt-2">
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            <strong>Error:</strong> El campo es requerido.
                        </div>
                    }
                    @if (costo?.errors?.['min']) {
                        <div class="alert alert-dismissible alert-danger mt-2">
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            <strong>Error:</strong> Debe ingresar un valor superior a {{minPrecio}}.
                        </div>
                    }
                    @if (costo?.errors?.['max']) {
                        <div class="alert alert-dismissible alert-danger mt-2">
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            <strong>Error:</strong> Debe ingresar un valor inferior a {{maxPrecio}}.
                        </div>
                    }
                }
            </div>            
        </div>

        <div class="col-md-6 mb-4">
            <div class="form-floating">
                <select class="form-select" id="tipoIva" [(ngModel)]="producto.vatType" name="tipoIva" #tipoIva="ngModel" required>
                    <option disabled selected>Seleccione</option>
                    <option value="TARIFA_CERO">Sin Iva</option>
                    <option value="TARIFA_REDUCIDA">Reducida</option>
                    <option value="TARIFA_GENERAL">General</option>
                </select>
                <label for="tipoIva">Tipo IVA</label>
                @if (tipoIva.invalid && (tipoIva.touched || formulario.submitted)) {
                    @if (tipoIva?.errors?.['required']) {
                        <div class="alert alert-dismissible alert-danger mt-2">
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            <strong>Error:</strong> El campo es requerido.
                        </div>
                    }
                }
            </div>
        </div>

        <div class="col-md-6 mb-4">
            <div class="form-floating">
                <select class="form-select" id="tipoVenta" [(ngModel)]="producto.saleType" name="tipoVenta" #tipoVenta="ngModel" required>
                    <option disabled selected>Seleccione</option>
                    <option value="PESO">Peso</option>
                    <option value="UNIDAD">Unidad</option>
                </select>
                <label for="exampleSelect1">Tipo Venta</label>
                @if (tipoVenta.invalid && (tipoVenta.touched || formulario.submitted)) {
                    @if (tipoVenta?.errors?.['required']) {
                        <div class="alert alert-dismissible alert-danger mt-2">
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            <strong>Error:</strong> El campo es requerido.
                        </div>
                    }
                }
            </div>
        </div>

        <div class="d-flex justify-content-between">
            <div class="d-grid gap-2">
                <button class="btn btn-danger" type="reset" (click)="limpiarForm()">Limpiar</button>
            </div>

            @if (producto.id) {
                <div class="d-grid gap-2 me-2">
                    <button class="btn btn-success" (click)="editarProducto(formulario)">Editar</button>
                </div>
            } 
            @if (!producto.id) {
                <div class="d-grid gap-2 me-2">
                    <button class="btn btn-success" (click)="guardarProducto(formulario)">Guardar</button>
                </div>
            }
        </div>
    </form>
</div>